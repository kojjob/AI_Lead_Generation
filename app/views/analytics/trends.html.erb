<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
  <!-- Trends Analytics Header -->
  <div class="bg-white/80 backdrop-blur-sm border-b border-indigo-100 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-4">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
              Trend Analysis
            </h1>
            <p class="mt-1 text-gray-600">Predictive analytics and trend forecasting</p>
          </div>
          
          <!-- Forecast Period Selector -->
          <div class="flex items-center space-x-3">
            <span class="text-sm text-gray-600">Forecast Period:</span>
            <select class="rounded-lg border-gray-300 text-sm focus:ring-indigo-500 focus:border-indigo-500">
              <option>Next 7 Days</option>
              <option>Next 14 Days</option>
              <option>Next 30 Days</option>
              <option>Next Quarter</option>
            </select>
          </div>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="mt-4 flex space-x-1 border-b border-gray-200">
          <%= link_to "Overview", analytics_path, class: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-t-lg" %>
          <%= link_to "Performance", analytics_performance_path, class: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-t-lg" %>
          <%= link_to "Trends", analytics_trends_path, class: "px-4 py-2 text-sm font-medium text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50 rounded-t-lg" %>
          <%= link_to "Keywords", analytics_keywords_path, class: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-t-lg" %>
          <%= link_to "Leads", analytics_leads_path, class: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-t-lg" %>
          <%= link_to "Integrations", analytics_integrations_path, class: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-t-lg" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Trends Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Forecast Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <% if @predictions %>
        <% [
          { title: "Predicted Mentions", value: @predictions[:next_week_forecast][:mentions], confidence: @predictions[:confidence_intervals][:mentions], icon: "trending-up", color: "indigo" },
          { title: "Predicted Leads", value: @predictions[:next_week_forecast][:leads], confidence: @predictions[:confidence_intervals][:leads], icon: "users", color: "purple" },
          { title: "Expected Conversion", value: "#{@predictions[:next_week_forecast][:conversion_rate]}%", confidence: @predictions[:confidence_intervals][:conversion], icon: "chart", color: "pink" },
          { title: "Growth Rate", value: "#{@predictions[:trend_projection][:growth_rate]}%", confidence: 95, icon: "growth", color: "green" }
        ].each do |forecast| %>
          <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between mb-3">
              <div class="p-2 bg-<%= forecast[:color] %>-100 rounded-lg">
                <svg class="w-5 h-5 text-<%= forecast[:color] %>-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                </svg>
              </div>
              <span class="text-xs text-gray-500">
                <%= forecast[:confidence] %>% confidence
              </span>
            </div>
            <p class="text-xs text-gray-600 uppercase tracking-wider mb-1"><%= forecast[:title] %></p>
            <p class="text-2xl font-bold text-gray-900"><%= forecast[:value] %></p>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Main Trend Chart -->
    <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 mb-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-900">Historical Trends & Predictions</h3>
        <div class="flex items-center space-x-3">
          <button class="px-3 py-1.5 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg">All Metrics</button>
          <button class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg">Mentions</button>
          <button class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg">Leads</button>
          <button class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg">Conversion</button>
        </div>
      </div>
      
      <div class="relative h-96">
        <canvas id="mainTrendChart" class="absolute inset-0 w-full h-full"></canvas>
      </div>
      
      <!-- Chart Legend -->
      <div class="mt-4 flex items-center justify-center space-x-6">
        <div class="flex items-center space-x-2">
          <div class="w-3 h-3 bg-indigo-500 rounded-full"></div>
          <span class="text-sm text-gray-600">Historical Data</span>
        </div>
        <div class="flex items-center space-x-2">
          <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
          <span class="text-sm text-gray-600">Trend Line</span>
        </div>
        <div class="flex items-center space-x-2">
          <div class="w-3 h-3 bg-pink-500 rounded-full opacity-50"></div>
          <span class="text-sm text-gray-600">Forecast</span>
        </div>
        <div class="flex items-center space-x-2">
          <div class="w-3 h-3 bg-gray-300 rounded-full opacity-30"></div>
          <span class="text-sm text-gray-600">Confidence Interval</span>
        </div>
      </div>
    </div>

    <!-- Growth Metrics Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <!-- Growth Analysis -->
      <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Growth Analysis</h3>
        <% if @growth_metrics %>
          <div class="space-y-4">
            <% @growth_metrics.each do |metric, data| %>
              <div>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-gray-700"><%= metric.to_s.humanize %></span>
                  <span class="text-sm font-semibold <%= data[:trend] == 'up' ? 'text-green-600' : 'text-red-600' %>">
                    <%= data[:trend] == 'up' ? '↑' : '↓' %> <%= data[:percentage] %>%
                  </span>
                </div>
                <div class="text-xs text-gray-500">
                  <%= data[:description] %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Seasonality Patterns -->
      <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Seasonality Patterns</h3>
        <% if @seasonality %>
          <div class="space-y-3">
            <div class="text-sm text-gray-600 mb-3">
              Peak activity detected:
            </div>
            <% @seasonality[:patterns].each do |pattern| %>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="text-sm font-medium text-gray-900"><%= pattern[:period] %></p>
                  <p class="text-xs text-gray-500"><%= pattern[:description] %></p>
                </div>
                <div class="text-right">
                  <p class="text-lg font-semibold text-indigo-600">+<%= pattern[:impact] %>%</p>
                  <p class="text-xs text-gray-500">vs average</p>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Anomaly Detection -->
      <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Anomaly Detection</h3>
        <div class="space-y-3">
          <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-yellow-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
              <div>
                <p class="text-sm font-medium text-yellow-900">Unusual Activity Detected</p>
                <p class="text-xs text-yellow-700 mt-1">30% spike in mentions from Instagram on Tuesday</p>
              </div>
            </div>
          </div>
          
          <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <div>
                <p class="text-sm font-medium text-green-900">Positive Trend</p>
                <p class="text-xs text-green-700 mt-1">Lead quality improving consistently over past 2 weeks</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Trend Tables -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Mention Trends -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Mention Trends by Source</h3>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trend</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Forecast</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% if @trend_data[:mention_trend][:by_source] %>
                <% @trend_data[:mention_trend][:by_source].each do |source| %>
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      <%= source[:name] %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= number_with_delimiter(source[:current]) %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <span class="<%= source[:trend] > 0 ? 'text-green-600' : 'text-red-600' %> text-sm font-medium">
                          <%= source[:trend] > 0 ? '↑' : '↓' %> <%= number_to_percentage(source[:trend].abs, precision: 1) %>
                        </span>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= number_with_delimiter(source[:forecast]) %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Lead Quality Trends -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Lead Quality Trends</h3>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">7-Day Avg</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">30-Day Avg</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% if @trend_data[:quality_trend] %>
                <% @trend_data[:quality_trend].each do |metric, values| %>
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      <%= metric.to_s.humanize %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= values[:current] %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= values[:seven_day_avg] %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= values[:thirty_day_avg] %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Main Trend Chart with Predictions
  const ctx = document.getElementById('mainTrendChart');
  if (ctx) {
    // Generate sample historical and forecast data
    const historicalDates = Array.from({length: 30}, (_, i) => {
      const date = new Date();
      date.setDate(date.getDate() - (30 - i));
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    
    const forecastDates = Array.from({length: 7}, (_, i) => {
      const date = new Date();
      date.setDate(date.getDate() + i + 1);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    
    const allDates = [...historicalDates, ...forecastDates];
    
    // Sample data - replace with actual data from controller
    const historicalData = Array.from({length: 30}, () => Math.floor(Math.random() * 50) + 50);
    const forecastData = Array(30).fill(null).concat(Array.from({length: 7}, () => Math.floor(Math.random() * 30) + 70));
    const upperBound = Array(30).fill(null).concat(Array.from({length: 7}, () => Math.floor(Math.random() * 20) + 80));
    const lowerBound = Array(30).fill(null).concat(Array.from({length: 7}, () => Math.floor(Math.random() * 20) + 60));
    
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: allDates,
        datasets: [{
          label: 'Historical Data',
          data: historicalData.concat(Array(7).fill(null)),
          borderColor: 'rgb(99, 102, 241)',
          backgroundColor: 'rgba(99, 102, 241, 0.1)',
          borderWidth: 2,
          fill: false,
          tension: 0.4
        }, {
          label: 'Trend Line',
          data: historicalData.concat(Array(7).fill(null)),
          borderColor: 'rgb(168, 85, 247)',
          borderWidth: 2,
          borderDash: [5, 5],
          fill: false,
          tension: 0.4
        }, {
          label: 'Forecast',
          data: forecastData,
          borderColor: 'rgb(236, 72, 153)',
          backgroundColor: 'rgba(236, 72, 153, 0.1)',
          borderWidth: 2,
          borderDash: [2, 2],
          fill: false,
          tension: 0.4
        }, {
          label: 'Upper Bound',
          data: upperBound,
          borderColor: 'rgba(156, 163, 175, 0.3)',
          backgroundColor: 'rgba(156, 163, 175, 0.05)',
          borderWidth: 1,
          fill: '+1',
          tension: 0.4
        }, {
          label: 'Lower Bound',
          data: lowerBound,
          borderColor: 'rgba(156, 163, 175, 0.3)',
          backgroundColor: 'rgba(156, 163, 175, 0.05)',
          borderWidth: 1,
          fill: '-1',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            callbacks: {
              title: function(context) {
                return context[0].label;
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              drawBorder: false
            }
          }
        }
      }
    });
  }
});
</script>